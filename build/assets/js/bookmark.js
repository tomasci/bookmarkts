// bookmark.ts
// skyparadise.org, evgenyberezin.com

"use strict";window.onload=function(){new Bookmark({hoverZoneTimeout:100,scrollPosition:"center",scrollBehavior:"smooth",showPanelOnScroll:!0,showPanelOnScrollTimeout:700})};var Bookmark=function(){function e(e){this.bookmark_cache=null,this.settings=e,this.body=document.body,this.CreateHoverZone(),this.CreatePanel(),this.OnScrollEvent(),this.GetBrowserHash()}return e.prototype.CreateHoverZone=function(){var t=this,e=document.createElement("div");e.classList.add("bookmark-hoverzone"),e.addEventListener("mouseenter",function(e){return t.HandleHoverZone(e,t)}),this.bm_hzone=e,this.body.appendChild(this.bm_hzone)},e.prototype.CreatePanel=function(){var t=this,e=document.createElement("div");e.classList.add("bookmark-panel"),e.addEventListener("mouseleave",function(e){return t.HandlePanelZone(e,t)}),e.addEventListener("mouseover",function(e){t.mouse_over_panel=!0});var o=document.createElement("div");o.classList.add("bookmark-panel-container"),e.appendChild(o),this.bm_panel=e,this.bm_panel_container=o,this.LoadStructure(this.bm_panel_container),this.body.appendChild(this.bm_panel)},e.prototype.SelectAllBookmarks=function(){return null==this.bookmark_cache&&(this.bookmark_cache=document.querySelectorAll(".bookmark")),this.bookmark_cache},e.prototype.LoadStructure=function(o){var n=this;this.SelectAllBookmarks().forEach(function(e,t){o.appendChild(n.MakeAnchor(e,t))})},e.prototype.MakeAnchor=function(t,e){var o=this,n=document.createElement("a");n.innerText=t.dataset.bookmarkTitle;var i="#bookmark-"+e;return n.href=i,n.addEventListener("click",function(e){e.preventDefault(),o.ScrollToElement(t),window.location.hash=i}),n.style.top=this.GetAnchorPosition(t)+"%",n},e.prototype.ScrollToElement=function(e){e.scrollIntoView({block:this.settings.scrollPosition,behavior:this.settings.scrollBehavior})},e.prototype.HandleHoverZone=function(e,t){t.ShowPanel()},e.prototype.HandlePanelZone=function(e,t){t.HidePanel(),this.mouse_over_panel=!1},e.prototype.ShowPanel=function(){this.bm_hzone.style.display="none",this.bm_panel.classList.add("bookmark-show")},e.prototype.HidePanel=function(){var e=this;this.bm_panel.classList.remove("bookmark-show"),setTimeout(function(){e.bm_hzone.style.display="block"},this.settings.hoverZoneTimeout)},e.prototype.GetDocumentHeight=function(){var e=document.body,t=document.documentElement;return Math.max(e.scrollHeight,e.offsetHeight,t.clientHeight,t.scrollHeight,t.offsetHeight)},e.prototype.GetElementPosition=function(e){var t=e.getBoundingClientRect();return{top:t.top+pageYOffset,left:t.left+pageXOffset}},e.prototype.GetAnchorPosition=function(e){var t=this.GetDocumentHeight();return 90*this.GetElementPosition(e).top/t},e.prototype.OnScrollEvent=function(){var t=this;document.addEventListener("scroll",function(e){window.clearTimeout(t.isScrolling),t.ShowPanel(),t.isScrolling=setTimeout(function(){t.mouse_over_panel||t.HidePanel()},t.settings.showPanelOnScrollTimeout)})},e.prototype.GetBrowserHash=function(){var t=this,e=window.location.hash.split("-");if("#bookmark"==e[0]){var o=this.SelectAllBookmarks();this.ScrollToElement(o[e[1]])}window.addEventListener("hashchange",function(e){t.GetBrowserHash()})},e}();