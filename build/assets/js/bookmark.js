// bookmark.ts
// skyparadise.org, evgenyberezin.com

"use strict";window.onload=function(){new Bookmark({hoverZoneTimeout:100,scrollPosition:"center",scrollBehavior:"smooth",showPanelOnScroll:!0,showPanelOnScrollTimeout:700,mobileSupport:!1})};var Bookmark=function(){function t(t){this.bookmark_cache=null,this.settings=t,this.body=document.body,this.CheckMobile()?this.settings.mobileSupport&&this.Init():this.Init()}return t.prototype.Init=function(){0<this.SelectAllBookmarks().length&&(this.CreateHoverZone(),this.CreatePanel(),this.OnScrollEvent(),this.GetBrowserHash())},t.prototype.CreateHoverZone=function(){var e=this,t=document.createElement("div");t.classList.add("bookmark-hoverzone"),t.addEventListener("mouseenter",function(t){return e.HandleHoverZone(t,e)}),this.bm_hzone=t,this.body.appendChild(this.bm_hzone)},t.prototype.CreatePanel=function(){var e=this,t=document.createElement("div");t.classList.add("bookmark-panel"),t.addEventListener("mouseleave",function(t){return e.HandlePanelZone(t,e)}),t.addEventListener("mouseover",function(t){e.mouse_over_panel=!0});var o=document.createElement("div");o.classList.add("bookmark-panel-container"),t.appendChild(o),this.bm_panel=t,this.bm_panel_container=o,this.LoadStructure(this.bm_panel_container),this.body.appendChild(this.bm_panel)},t.prototype.SelectAllBookmarks=function(){if(null==this.bookmark_cache){var t=document.querySelectorAll(".bookmark"),e=[];t.forEach(function(t){"bookmarkTitle"in t.dataset&&""!=t.dataset.bookmarkTitle&&e.push(t)}),this.bookmark_cache=e}return this.bookmark_cache},t.prototype.LoadStructure=function(o){var n=this;this.SelectAllBookmarks().forEach(function(t,e){o.appendChild(n.MakeAnchor(t,e))})},t.prototype.MakeAnchor=function(e,t){var o=this,n=document.createElement("a");n.innerText=e.dataset.bookmarkTitle;var i="#bookmark-"+t;return n.href=i,n.addEventListener("click",function(t){t.preventDefault(),o.ScrollToElement(e),window.location.hash=i,o.last_hash=i}),n.style.top=this.GetAnchorPosition(e)+"%",n},t.prototype.ScrollToElement=function(t){t.scrollIntoView({block:this.settings.scrollPosition,behavior:this.settings.scrollBehavior})},t.prototype.HandleHoverZone=function(t,e){e.ShowPanel(!0)},t.prototype.HandlePanelZone=function(t,e){e.ShowPanel(!1)},t.prototype.ShowPanel=function(t){var e=this;t?(this.bm_hzone.style.display="none",this.bm_panel.classList.add("bookmark-show")):(this.bm_panel.classList.remove("bookmark-show"),this.mouse_over_panel=!1,setTimeout(function(){e.bm_hzone.style.display="block"},this.settings.hoverZoneTimeout))},t.prototype.GetDocumentHeight=function(){var t=document.body,e=document.documentElement;return Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight)},t.prototype.GetElementPosition=function(t){var e=t.getBoundingClientRect();return{top:e.top+pageYOffset,left:e.left+pageXOffset}},t.prototype.GetAnchorPosition=function(t){var e=this.GetDocumentHeight();return 90*this.GetElementPosition(t).top/e},t.prototype.OnScrollEvent=function(){var e=this;document.addEventListener("scroll",function(t){window.clearTimeout(e.isScrolling),e.ShowPanel(!0),e.isScrolling=setTimeout(function(){e.mouse_over_panel||e.ShowPanel(!1)},e.settings.showPanelOnScrollTimeout)})},t.prototype.GetBrowserHash=function(){var e=this,t=window.location.hash,o=t.split("-");if(this.last_hash!=t){if("#bookmark"==o[0]){var n=this.SelectAllBookmarks();Number(o[1])<n.length&&this.ScrollToElement(n[o[1]])}window.addEventListener("hashchange",function(t){e.GetBrowserHash()})}},t.prototype.CheckMobile=function(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},t}();